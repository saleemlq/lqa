<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Duas Manager</title>

  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="duas.js" defer></script>

  <style>
        /* theme matched and refined */
        @import url("https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap");

        * {
            cursor: default;
            user-select: none;
            box-sizing: border-box;
        }

        @font-face {
            font-family: 'Muhammadi';
            src: url('./muhammadi.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Quicksand", sans-serif;
            background: radial-gradient(circle at top left, #101010, #0c0c0c 80%);
            color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 32px;
            position: relative;
            z-index: 1;
            overflow-x: hidden
        }

        body::before,
        body::after {
            content: "";
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at 30% 30%, rgba(255, 235, 59, 0.06), transparent 60%), radial-gradient(ellipse at 70% 80%, rgba(0, 255, 204, 0.04), transparent 70%);
            animation: bgMove 40s infinite linear;
            z-index: 0;
            pointer-events: none;
        }

        body::after {
            animation-direction: reverse;
            opacity: 0.6;
            filter: blur(20px);
        }

        @keyframes bgMove {
            0% {
                transform: rotate(0deg) scale(1)
            }

            100% {
                transform: rotate(360deg) scale(1)
            }
        }

        #app {
            width: 100%;
            max-width: 980px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            border-radius: 20px;
            padding: 1.6rem;
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            position: relative;
            z-index: 1;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .top-left {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .top-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* custom student select */
        .custom-select-wrapper {
            position: relative;
        }

        .custom-select-display {
            min-width: 240px;
            padding: 10px 16px;
            border-radius: 12px;
            background: linear-gradient(145deg, #1a1a1a, #121212);
            border: 1px solid #444;
            color: #fdfdfd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .custom-select-display:hover {
            border-color: #00ffc8;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 200, 0.06);
        }

        .dropdown-options {
            position: absolute;
            top: 110%;
            right: 0;
            width: 320px;
            max-height: 260px;
            overflow: auto;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            display: none;
            z-index: 10;
        }

        .custom-select-wrapper.open .dropdown-options {
            display: block;
        }

        .dropdown-options li {
            padding: 10px 12px;
            border-bottom: 1px solid #222;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s, transform 0.18s;
        }

        .dropdown-options li:hover {
            background: linear-gradient(145deg, #222, #292929);
            color: #fff;
            transform: translateX(-6px);
        }

        /* universal button hover */
        .btn {
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid #444;
            background: #141414;
            color: #fff;
            cursor: pointer;
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
        }

        .btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 255, 200, 0.08);
            border-color: #00ffc8;
        }

        .btn.positive {
            background: linear-gradient(145deg, #0b3, #0af5d6);
            color: #111;
            border-color: transparent;
        }

        .btn.positive:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 14px 40px rgba(10, 245, 214, 0.16);
        }

        .btn.warn {
            background: linear-gradient(145deg, #2d2d2d, #1f1f1f);
            border: 1px solid #ffb84d;
            color: #ffe761;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .dua-list li {
            background: linear-gradient(145deg, #181818, #1e1e1e);
            margin: 12px 0;
            padding: 16px 18px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            border: 1px solid #333;
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
            position: relative;
        }

        .dua-list li.started {
            background: linear-gradient(145deg, #123b26, #183a2b);
            border-color: #0fbf86;
            box-shadow: 0 8px 30px rgba(11, 191, 134, 0.05);
        }

        .dua-list li:hover {
            transform: translateY(-6px) scale(1.02);
            border-color: #00ffc8;
            box-shadow: 0 12px 46px rgba(0, 255, 200, 0.12);
        }

        .dua-name {
            font-weight: 700;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ffc8;
            box-shadow: 0 0 6px #00ffc888;
            margin-left: 8px;
        }

        /* Dua view - full focus */
        .dua-screen-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 72vh;
        }

        .dua-title {
            color: #ffe761;
            font-size: 2.2rem;
            font-weight: 800;
            text-align: center;
            text-shadow: 0 6px 18px rgba(255, 231, 97, 0.06);
        }

        .dua-arabic {
            font-family: 'Muhammadi', serif;
            font-size: 3.2rem;
            direction: rtl;
            text-align: center;
            margin-top: 12px;
            line-height: 1.35;
        }

        .dua-translation {
            margin-top: 16px;
            color: #ddd;
            font-size: 1.25rem;
            text-align: center;
            max-width: 900px;
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-top: 18px;
        }

        /* Done list */
        .done-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .done-list .done-card {
            background: linear-gradient(145deg, #181818, #1e1e1e);
            border-radius: 12px;
            padding: 12px 14px;
            margin: 12px 0;
            display: flex;
            gap: 12px;
            align-items: flex-start;
            position: relative;
            transition: transform 0.18s, box-shadow 0.18s;
        }

        .done-list .done-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
        }

        .done-card .left {
            width: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .check-btn {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            border: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.16s, box-shadow 0.16s;
        }

        .check-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 255, 200, 0.06);
        }

        .check-btn.active {
            background: #00ffc8;
            color: #111;
            border-color: #00ffc8;
            box-shadow: 0 10px 30px rgba(0, 255, 200, 0.15);
        }

        .done-card .content {
            flex: 1;
        }

        .done-card .content .dua-arabic {
            font-size: 20px;
        }

        /* toggles (top-right of card) */
        .card-top-right {
            position: absolute;
            right: 18px;
            top: 12px;
            display: flex;
            gap: 8px;
            z-index: 5;
        }

        .toggle-btn {
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid #444;
            background: linear-gradient(145deg, #121212, #101010);
            color: #aaa;
            cursor: pointer;
            transition: all 0.16s ease;
        }

        .toggle-btn:hover {
            transform: translateY(-3px);
            color: #fff;
            border-color: #00ffc8;
            box-shadow: 0 8px 20px rgba(0, 255, 200, 0.06);
        }

        .toggle-btn.on {
            background: #00ffc8;
            color: #071617;
            border-color: #00ffc8;
            box-shadow: 0 12px 30px rgba(0, 255, 200, 0.14);
        }

        /* reports: two charts in a row, balanced */
        .reports-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            align-items: start;
        }

        canvas {
            width: 100% !important;
            height: 240px !important;
        }

        /* helpers */
        .muted {
            color: #aaa;
            font-size: 0.9rem;
        }

        .count-badge {
            background: rgba(0, 255, 200, 0.06);
            border: 1px solid #00ffc8;
            color: #00ffc8;
            padding: 6px 8px;
            border-radius: 10px;
        }

        @media(max-width:900px) {
            .reports-row {
                grid-template-columns: 1fr;
            }

            .dua-arabic {
                font-size: 2.2rem
            }
        }
    </style>
</head>
<body>
  <div id="app">
    <div class="top-bar">
      <div class="top-left nav-buttons">
        <button id="backToListBtn" class="btn">⬅ Back</button>
        <button id="viewDoneBtn" class="btn">Done Duas</button>
        <button id="viewReportBtn" class="btn">Reports</button>
      </div>

      <div class="top-right">
        <div class="custom-select-wrapper" id="studentWrapper">
          <div class="custom-select-display" id="studentDisplay">Select student ▾</div>
          <ul class="dropdown-options" id="studentOptions"></ul>
        </div>
      </div>
    </div>

    <!-- List Screen -->
    <div id="listScreen" class="screen active">
      <h2>Available Duas</h2>
      <div class="muted">Click name to open. Green dot = started. Done duas are hidden.</div>
      <ul id="duaList" class="dua-list"></ul>
    </div>

    <!-- Dua View Screen -->
    <div id="duaScreen" class="screen">
      <div class="dua-screen-wrap">
        <div style="position:relative; width:100%; max-width:900px;">
          <div class="card-top-right"></div>
          <h1 id="duaTitle" class="dua-title">Dua Title</h1>
          <div id="duaArabic" class="dua-arabic">اَلسَّلَامُ عَلَيْكُمْ</div>
          <div id="duaTranslation" class="dua-translation">Translation here...</div>
          <div class="controls">
            <button id="startBtn" class="btn">Start</button>
            <button id="skipBtn" class="btn">Skip</button>
            <button id="markDoneBtn" class="btn positive">Mark as Done</button>
          </div>
          <div style="margin-top:12px; display:flex; justify-content:center; gap:12px;">
            <button id="prevDuaBtn" class="btn">◀ Prev</button>
            <div class="muted" id="duaIndexInfo">1 / 10</div>
            <button id="nextDuaBtn" class="btn">Next ▶</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Done Screen -->
    <div id="doneScreen" class="screen">
      <div class="done-header">
        <h2 id="doneHeaderTitle">Done Duas</h2>
        <div class="count-badge">Applied today: <span id="appliedCount">0</span> / <span id="totalDoneCount">0</span></div>
      </div>
      <div class="muted">Date: <span id="doneDate"></span></div>
      <div id="doneList" class="done-list" style="margin-top:12px;"></div>
    </div>

    <!-- Report Screen -->
    <div id="reportScreen" class="screen">
      <h2>Reports</h2>
      <div class="reports-row">
        <canvas id="barChart"></canvas>
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Import duas -->
  <script type="module">
    import { duas } from './duas.js';
    window.__DUAS_DATA__ = duas;
  </script>

  <script>
    const STORAGE = {
      students: 'listOfStudents',
      duas: 'duasList',
      progress: 'duaProgress_v1',
      daily: 'dailyProgress_v1'
    };
    function $(s) { return document.querySelector(s) }
    function isoDate(d) { return d.toISOString().split('T')[0]; }

    // Load data
    let students = JSON.parse(localStorage.getItem(STORAGE.students) || JSON.stringify([]));

    let remoteDuas = window.__DUAS_DATA__ || [];
    let duas = JSON.parse(localStorage.getItem(STORAGE.duas) || 'null') || remoteDuas;
    if (!duas || duas.length === 0) {
      duas = remoteDuas;
      localStorage.setItem(STORAGE.duas, JSON.stringify(duas));
    }

    let duaProgress = JSON.parse(localStorage.getItem(STORAGE.progress) || '{}');
    let dailyProgress = JSON.parse(localStorage.getItem(STORAGE.daily) || '{}');

    // UI refs
    const studentWrapper = $('#studentWrapper');
    const studentDisplay = $('#studentDisplay');
    const studentOptions = $('#studentOptions');
    const viewDoneBtn = $('#viewDoneBtn');
    const backToListBtn = $('#backToListBtn');
    const viewReportBtn = $('#viewReportBtn');

    const duaListEl = $('#duaList');
    const listScreen = $('#listScreen');
    const duaScreen = $('#duaScreen');
    const doneScreen = $('#doneScreen');
    const reportScreen = $('#reportScreen');

    const duaTitle = $('#duaTitle');
    const duaArabic = $('#duaArabic');
    const duaTranslation = $('#duaTranslation');
    const startBtn = $('#startBtn');
    const skipBtn = $('#skipBtn');
    const markDoneBtn = $('#markDoneBtn');
    const prevDuaBtn = $('#prevDuaBtn');
    const nextDuaBtn = $('#nextDuaBtn');
    const duaIndexInfo = $('#duaIndexInfo');

    const doneDateEl = $('#doneDate');
    const doneListEl = $('#doneList');
    const appliedCountEl = $('#appliedCount');
    const totalDoneCountEl = $('#totalDoneCount');

    const barCanvas = $('#barChart');
    const pieCanvas = $('#pieChart');

    // state
    let currentStudent = students[0];
    let filteredList = [];
    let currentIndex = 0;

    // helpers
    function saveProgress() { localStorage.setItem(STORAGE.progress, JSON.stringify(duaProgress)); }
    function saveDaily() { localStorage.setItem(STORAGE.daily, JSON.stringify(dailyProgress)); }
    function saveStudents() { localStorage.setItem(STORAGE.students, JSON.stringify(students)); }
    function saveDuas() { localStorage.setItem(STORAGE.duas, JSON.stringify(duas)); }

    // student dropdown
    function renderStudentDropdown() {
      studentOptions.innerHTML = '';
      students.forEach(s => {
        const li = document.createElement('li');
        li.textContent = s;
        if (s === currentStudent) li.style.fontWeight = '700';
        li.addEventListener('click', () => { selectStudent(s); studentWrapper.classList.remove('open'); });
        studentOptions.appendChild(li);
      });
      studentDisplay.textContent = currentStudent + ' ▾';
    }

    studentDisplay.addEventListener('click', () => { studentWrapper.classList.toggle('open'); });
    function selectStudent(name) {
      currentStudent = name;
      renderStudentDropdown();
      renderList();
      if (document.querySelector('.screen.active') === doneScreen) showDoneList();
      updateReports();
    }

    function getStateFor(student, duaId) {
      if (!duaProgress[student]) return 'notstarted';
      return duaProgress[student][duaId] || 'notstarted';
    }
    function setStateFor(student, duaId, state) {
      if (!duaProgress[student]) duaProgress[student] = {};
      duaProgress[student][duaId] = state;
      saveProgress();
    }

    function renderList() {
      duaListEl.innerHTML = '';
      filteredList = duas.filter(d => getStateFor(currentStudent, d.id) !== 'done');
      if (filteredList.length === 0) {
        duaListEl.innerHTML = '<li class="muted">No available duas (all done)</li>';
        return;
      }
      filteredList.forEach((d, idx) => {
        const li = document.createElement('li');
        if (getStateFor(currentStudent, d.id) === 'started') li.classList.add('started');
        li.innerHTML = `<div class="dua-name">${d.name}</div>`;
        if (getStateFor(currentStudent, d.id) === 'started') {
          const dot = document.createElement('span'); dot.className = 'progress-dot';
          li.appendChild(dot);
        }
        li.addEventListener('click', () => openDuaByIndex(idx));
        duaListEl.appendChild(li);
      });
    }

    function showScreen(name) {
      [listScreen, duaScreen, doneScreen, reportScreen].forEach(s => s.classList.remove('active'));
      if (name === 'list') listScreen.classList.add('active');
      if (name === 'dua') duaScreen.classList.add('active');
      if (name === 'done') doneScreen.classList.add('active');
      if (name === 'report') reportScreen.classList.add('active');
    }

    function openDuaByIndex(i) {
      currentIndex = i;
      const dua = filteredList[currentIndex];
      duaTitle.textContent = dua.name;
      duaArabic.textContent = dua.arabic;
      duaTranslation.textContent = dua.translation;

      const st = getStateFor(currentStudent, dua.id);
      if (st === 'notstarted') {
        startBtn.textContent = 'Start';
        skipBtn.style.display = 'none';
        markDoneBtn.style.display = 'none';
      } else if (st === 'started') {
        startBtn.textContent = 'Mark as Done';
        skipBtn.style.display = 'inline-block';
        markDoneBtn.style.display = 'inline-block';
      }

      showScreen('dua');
      updateIndexInfo();
    }

    startBtn.addEventListener('click', () => {
      const dua = filteredList[currentIndex];
      const st = getStateFor(currentStudent, dua.id);
      if (st === 'notstarted') {
        setStateFor(currentStudent, dua.id, 'started');
        openDuaByIndex(currentIndex);
        renderList();
      } else if (st === 'started') {
        markThisDone();
      }
    });

    skipBtn.addEventListener('click', () => {
      const dua = filteredList[currentIndex];
      setStateFor(currentStudent, dua.id, 'notstarted');
      openDuaByIndex(currentIndex);
      renderList();
    });

    function markThisDone() {
      const dua = filteredList[currentIndex];
      setStateFor(currentStudent, dua.id, 'done');
      renderList();
      filteredList = duas.filter(d => getStateFor(currentStudent, d.id) !== 'done');
      if (filteredList.length > 0) {
        currentIndex = Math.min(currentIndex, filteredList.length - 1);
        openDuaByIndex(currentIndex);
      } else {
        showScreen('list');
      }
      updateReports();
    }

    markDoneBtn.addEventListener('click', markThisDone);
    prevDuaBtn.addEventListener('click', () => { if (currentIndex > 0) openDuaByIndex(currentIndex - 1); });
    nextDuaBtn.addEventListener('click', () => { if (currentIndex < filteredList.length - 1) openDuaByIndex(currentIndex + 1); });
    function updateIndexInfo() { duaIndexInfo.textContent = (currentIndex + 1) + ' / ' + filteredList.length; }

    function getDoneDuasFor(student) { return duas.filter(d => getStateFor(student, d.id) === 'done'); }

    function showDoneList() {
      const today = isoDate(new Date());
      doneDateEl.textContent = today;
      const done = getDoneDuasFor(currentStudent);
      totalDoneCountEl.textContent = done.length;
      doneListEl.innerHTML = '';
      done.forEach(d => {
        const card = document.createElement('div');
        card.className = 'done-card';
        card.innerHTML = `<div class="content"><div class="dua-name">${d.name}</div><div class="dua-arabic">${d.arabic}</div><div class="dua-translation">${d.translation}</div></div>`;
        doneListEl.appendChild(card);
      });
      appliedCountEl.textContent = done.length;
    }

    // Reports
    let barChart = null, pieChart = null;
    function updateReports() {
      const done = getDoneDuasFor(currentStudent).length;
      const remaining = duas.length - done;
      if (barChart) barChart.destroy();
      barChart = new Chart(barCanvas.getContext('2d'), {
        type: 'bar',
        data: { labels: ['Done','Remaining'], datasets: [{ data: [done, remaining], backgroundColor: ['#00ffc8','#444'] }] }
      });
      if (pieChart) pieChart.destroy();
      pieChart = new Chart(pieCanvas.getContext('2d'), {
        type: 'pie',
        data: { labels: ['Done','Remaining'], datasets: [{ data: [done, remaining], backgroundColor: ['#00ffc8','#444'] }] }
      });
    }

    // Nav buttons
    viewDoneBtn.addEventListener('click', () => { showScreen('done'); showDoneList(); });
    backToListBtn.addEventListener('click', () => { showScreen('list'); });
    viewReportBtn.addEventListener('click', () => { showScreen('report'); updateReports(); });

    // init
    renderStudentDropdown();
    renderList();
  </script>
</body>
</html>
